package model;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class Guest {

	Connection con;
	String nombre;
	String apellido;
	Date fechaNacimiento;
	String nacionalidad;
	String telefono;
		
	public Guest(Connection con, String nombre, String apellido, String fechaNacimiento, String nacionalidad, String telefono) {
		this.con = con;
		this.nombre = nombre;
		this.apellido = apellido;
		this.fechaNacimiento = Date.valueOf(fechaNacimiento);
		this.nacionalidad = nacionalidad;
		this.telefono = telefono;
	}
	
	public void insertGuest() throws SQLException {
		String statement = "INSERT INTO HUESPEDES (nombre, apellido, fechaNacimiento, nacionalidad, telefono) VALUES (?, ?, ?, ?, ?)";
		PreparedStatement stm = con.prepareStatement(statement, Statement.RETURN_GENERATED_KEYS);
		
		stm.setString(1, nombre);
		stm.setString(2, apellido);
		stm.setDate(3, fechaNacimiento);
		stm.setString(4, nacionalidad);
		stm.setString(5, telefono);
		
		stm.execute();
		
		ResultSet rst = stm.getGeneratedKeys();
		while(rst.next()) {
			Integer id = rst.getInt(1);
			System.out.println("New guest inserted with id = " + id);
		}
	}
	
	public void updateGuest(String nombre, String apellido, String fechaNacimiento, String nacionalidad, String telefono) throws SQLException {
		
//		Googlear cómo simplificar el statement
		String statement = "UPDATE HUESPEDES SET nombre = ?, apellido = ?, fechaNacimiento = ?, nacionalidad = ?, telefono = ? "
				+ "WHERE nombre = ? AND apellido = ? AND fechaNacimiento = ? AND nacionalidad = ? AND telefono = ?";
		PreparedStatement stm = con.prepareStatement(statement, Statement.RETURN_GENERATED_KEYS);
		
		stm.setString(6, this.nombre);
		stm.setString(7, this.apellido);
		stm.setDate(8, this.fechaNacimiento);
		stm.setString(9, this.nacionalidad);
		stm.setString(10, this.telefono);
		
		this.nombre = nombre;
		this.apellido = apellido;
		this.fechaNacimiento = Date.valueOf(fechaNacimiento);
		this.nacionalidad = nacionalidad;
		this.telefono = telefono;

		stm.setString(1, this.nombre);
		stm.setString(2, this.apellido);
		stm.setDate(3, this.fechaNacimiento);
		stm.setString(4, this.nacionalidad);
		stm.setString(5, this.telefono);
		
		stm.execute();
	}
	
	public void removeGuest() throws SQLException {
//		Googlear cómo simplificar el statement
		String statement = "DELETE FROM HUESPEDES WHERE nombre = ? AND apellido = ? AND fechaNacimiento = ? AND nacionalidad = ? AND telefono = ?";
		PreparedStatement stm = con.prepareStatement(statement, Statement.RETURN_GENERATED_KEYS);
		
		stm.setString(1, nombre);
		stm.setString(2, apellido);
		stm.setDate(3, fechaNacimiento);
		stm.setString(4, nacionalidad);
		stm.setString(5, telefono);
		stm.execute();
		
//		Falta hacer que me indique el/los id de los huespedes eliminados
//		ResultSet rst = stm.getGeneratedKeys();
//		while(rst.next()) {
//			Integer id = rst.getInt(1);
//			System.out.println("Guest deleted with id = " + id);
//		}
		System.out.println("End of deletion, cant say if deleted");
	}

	public Integer getId() throws SQLException {
		Integer id = null;
		
		String statement = "SELECT id FROM HUESPEDES WHERE nombre = ? AND apellido = ? AND fechaNacimiento = ? AND nacionalidad = ? AND telefono = ?";
		PreparedStatement stm = con.prepareStatement(statement, Statement.RETURN_GENERATED_KEYS);
		
		stm.setString(1, nombre);
		stm.setString(2, apellido);
		stm.setDate(3, fechaNacimiento);
		stm.setString(4, nacionalidad);
		stm.setString(5, telefono);
		stm.execute();
		
		ResultSet rst = stm.getResultSet();
		while(rst.next()) {
			id = rst.getInt(1);
			System.out.println("Guest id = " + id);
		}
		return id;
	}


}